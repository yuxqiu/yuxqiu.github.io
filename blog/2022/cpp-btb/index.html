<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta name="view-transition" content="same-origin"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="author" content="Yuxiang Qiu"> <title>Notes: Back To Basics CppCon20 | Yuxiang Qiu</title> <meta name="generator" content="Jekyll v4.4.1"> <meta property="og:title" content="Notes: Back To Basics CppCon20"> <meta property="og:locale" content="en"> <meta name="description" content="Copyright: Copyright © 2020 Bob Steagall"> <meta property="og:description" content="Copyright: Copyright © 2020 Bob Steagall"> <link rel="canonical" href="https://yuxqiu.github.io/blog/2022/cpp-btb/"> <meta property="og:url" content="https://yuxqiu.github.io/blog/2022/cpp-btb/"> <meta property="og:site_name" content="Yuxiang Qiu"> <meta property="og:image" content="https://yuxqiu.github.io/assets/img/og/posts/cpp-btb.png"> <meta property="og:image:height" content="600"> <meta property="og:image:width" content="1200"> <meta property="og:image:alt" content="Notes: Back To Basics CppCon20"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2022-10-29T01:06:13+00:00"> <meta name="twitter:card" content="summary_large_image"> <meta property="twitter:image" content="https://yuxqiu.github.io/assets/img/og/posts/cpp-btb.png"> <meta name="twitter:image:alt" content="Notes: Back To Basics CppCon20"> <meta property="twitter:title" content="Notes: Back To Basics CppCon20"> <meta name="twitter:site" content="@yuxqiu"> <meta name="google-site-verification" content="OyP7PF7v8xjEbPqbdYaMosljunIcAOjdw_C6-TtA8f0"> <meta name="msvalidate.01" content="231286930EDC7A744F88D1D05B1BD04A"> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-02-18T14:33:14+00:00","datePublished":"2022-10-29T01:06:13+00:00","description":"Copyright: Copyright © 2020 Bob Steagall","headline":"Notes: Back To Basics CppCon20","image":{"width":1200,"height":600,"alt":"Notes: Back To Basics CppCon20","url":"https://yuxqiu.github.io/assets/img/og/posts/cpp-btb.png","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://yuxqiu.github.io/blog/2022/cpp-btb/"},"url":"https://yuxqiu.github.io/blog/2022/cpp-btb/"}</script> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://yuxqiu.github.io/blog/2022/cpp-btb/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class=" "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm sticky-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> Yuxiang Qiu </a> <input type="checkbox" id="navbar-toggler-checkbox" class="navbar-toggler-checkbox" hidden> <label for="navbar-toggler-checkbox" class="navbar-toggler ml-auto"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </label> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/ss/index.html">SS </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <svg id="light-toggle-system" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M9.173 14.83a4 4 0 1 1 5.657 -5.657"></path><path d="M11.294 12.707l.174 .247a7.5 7.5 0 0 0 8.845 2.492a9 9 0 0 1 -14.671 2.914"></path><path d="M3 12h1"></path><path d="M12 3v1"></path><path d="M5.6 5.6l.7 .7"></path><path d="M3 21l18 -18"></path></svg> <svg id="light-toggle-dark" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 1.992a10 10 0 1 0 9.236 13.838c.341 -.82 -.476 -1.644 -1.298 -1.31a6.5 6.5 0 0 1 -6.864 -10.787l.077 -.08c.551 -.63 .113 -1.653 -.758 -1.653h-.266l-.068 -.006l-.06 -.002z"></path></svg> <svg id="light-toggle-light" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="currentColor"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 19a1 1 0 0 1 .993 .883l.007 .117v1a1 1 0 0 1 -1.993 .117l-.007 -.117v-1a1 1 0 0 1 1 -1z"></path><path d="M18.313 16.91l.094 .083l.7 .7a1 1 0 0 1 -1.32 1.497l-.094 -.083l-.7 -.7a1 1 0 0 1 1.218 -1.567l.102 .07z"></path><path d="M7.007 16.993a1 1 0 0 1 .083 1.32l-.083 .094l-.7 .7a1 1 0 0 1 -1.497 -1.32l.083 -.094l.7 -.7a1 1 0 0 1 1.414 0z"></path><path d="M4 11a1 1 0 0 1 .117 1.993l-.117 .007h-1a1 1 0 0 1 -.117 -1.993l.117 -.007h1z"></path><path d="M21 11a1 1 0 0 1 .117 1.993l-.117 .007h-1a1 1 0 0 1 -.117 -1.993l.117 -.007h1z"></path><path d="M6.213 4.81l.094 .083l.7 .7a1 1 0 0 1 -1.32 1.497l-.094 -.083l-.7 -.7a1 1 0 0 1 1.217 -1.567l.102 .07z"></path><path d="M19.107 4.893a1 1 0 0 1 .083 1.32l-.083 .094l-.7 .7a1 1 0 0 1 -1.497 -1.32l.083 -.094l.7 -.7a1 1 0 0 1 1.414 0z"></path><path d="M12 2a1 1 0 0 1 .993 .883l.007 .117v1a1 1 0 0 1 -1.993 .117l-.007 -.117v-1a1 1 0 0 1 1 -1z"></path><path d="M12 7a5 5 0 1 1 -4.995 5.217l-.005 -.217l.005 -.217a5 5 0 0 1 4.995 -4.783z"></path></svg> </button> </li> </ul> </div> </div> </nav> </header> <main class="container mt-5 flex-grow-1" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Notes: Back To Basics CppCon20</h1> </header> <article class="post-content"> <hr> <div id="table-of-contents"> <ul id="toc" class="section-nav"> <li class="toc-entry toc-h2"> <a href="#back-to-basics-the-abstract-machine">Back to Basics: The Abstract Machine</a> <ul> <li class="toc-entry toc-h3"><a href="#what-is-an-abstract-machine">What is an abstract machine</a></li> <li class="toc-entry toc-h3"><a href="#c-abstract-machines">C++ Abstract Machines</a></li> <li class="toc-entry toc-h3"><a href="#rationale">Rationale</a></li> <li class="toc-entry toc-h3"><a href="#the-programmers-concern">The Programmer’s Concern</a></li> <li class="toc-entry toc-h3"><a href="#key-aspects-of-c-abstract-machine">Key aspects of C++ Abstract Machine</a></li> <li class="toc-entry toc-h3"><a href="#well-formed-ill-formed-and-ifndr-program">Well-Formed, ill-formed, and IFNDR Program</a></li> <li class="toc-entry toc-h3"> <a href="#structure-of-c-abstract-machine">Structure of C++ Abstract Machine</a> <ul> <li class="toc-entry toc-h4"><a href="#memory">Memory</a></li> <li class="toc-entry toc-h4"><a href="#objects">Objects</a></li> <li class="toc-entry toc-h4"><a href="#expressions">Expressions</a></li> <li class="toc-entry toc-h4"><a href="#threads">Threads</a></li> </ul> </li> </ul> </li> <li class="toc-entry toc-h2"> <a href="#btb-structure-of-program">BTB: structure of program</a> <ul> <li class="toc-entry toc-h3"><a href="#translational-units-and-phrase-of-translation">Translational Units and Phrase of Translation</a></li> <li class="toc-entry toc-h3"><a href="#declaration-and-definition">Declaration and Definition</a></li> <li class="toc-entry toc-h3"><a href="#linkage">Linkage</a></li> <li class="toc-entry toc-h3"><a href="#odr">ODR</a></li> <li class="toc-entry toc-h3"><a href="#abi">ABI</a></li> <li class="toc-entry toc-h3"><a href="#name-mangling">Name Mangling</a></li> </ul> </li> </ul> </div> <hr> <div id="markdown-content"> <blockquote> <p>Copyright: Copyright © 2020 Bob Steagall</p> </blockquote> <h2 id="back-to-basics-the-abstract-machine">Back to Basics: The Abstract Machine</h2> <blockquote> <p>Talk: https://www.youtube.com/watch?v=ZAji7PkXaKY</p> <p>PPT: <a href="https://github.com/CppCon/CppCon2020/blob/main/Presentations/back_to_basics_the_abstract_machine/back_to_basics_the_abstract_machine__bob_steagall__cppcon_2020.pdf" rel="external nofollow noopener" target="_blank">back_to_basics_the_abstract_machine__bob_steagall__cppcon_2020.pdf</a></p> </blockquote> <h3 id="what-is-an-abstract-machine">What is an abstract machine</h3> <blockquote> <p><strong>Abstract machines provide an intermediate language stage for compilation. They bridge the gap between the high level of a programming language and the low level of a real machine.</strong> The instructions of an abstract machine are tailored to the particular operations required to implement operations of a specific source language or class of lanquages.”</p> <p>Stephan Diehl, Pieter Hartel, Peter Sestoft Future Generation Computer Systems 16 2000)</p> </blockquote> <blockquote> <p>“Programming language specifications (not just C and C++, all high-level programming language specifications), <strong>define the languages in terms of an abstract machine, which, in this usage, is the simplest imaginary computer capable of executing a program in the source language</strong> (or a family of languages, as in the case of the JVM).” (my emphasis)</p> <p>Sergey Zubkow, www.quora.com (2015)</p> </blockquote> <h3 id="c-abstract-machines">C++ Abstract Machines</h3> <blockquote> <p>“The C++ abstract machine is a portable abstraction of your operating system, kernel and hardware. The abstract machine is the intermediary between your C++ program and the system that it is run on.”</p> <p>Bryce Adelstein Lelbach, Core C++ 2019, The C++ Execution Model</p> </blockquote> <h3 id="rationale">Rationale</h3> <p>We want abstraction to hide the complexity of different platforms.</p> <h3 id="the-programmers-concern">The Programmer’s Concern</h3> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2022/10/1667136550250-480.webp 480w,/assets/img/blog/2022/10/1667136550250-800.webp 800w,/assets/img/blog/2022/10/1667136550250-1400.webp 1400w," sizes="(max-width: 600px) 100vw, (max-width: 1200px) 80vw, 66vw" type="image/webp"></source> <img src="/assets/img/blog/2022/10/1667136550250.png" width="100%" height="auto" loading="lazy"> </picture> </figure> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2022/10/1667136556130-480.webp 480w,/assets/img/blog/2022/10/1667136556130-800.webp 800w,/assets/img/blog/2022/10/1667136556130-1400.webp 1400w," sizes="(max-width: 600px) 100vw, (max-width: 1200px) 80vw, 66vw" type="image/webp"></source> <img src="/assets/img/blog/2022/10/1667136556130.png" width="100%" height="auto" loading="lazy"> </picture> </figure> <p>Key takeaway: when we are writing C++ code, we are writing to the C++ Abstract Machine</p> <h3 id="key-aspects-of-c-abstract-machine">Key aspects of C++ Abstract Machine</h3> <blockquote> <p>The semantic descriptions in this document define a <strong>parameterized</strong> <strong>nondeterministic</strong> <strong>abstract machine</strong>. This document places no requirement on the structure of conforming <strong>implementations</strong>. In particular, they need not copy or emulate the structure of the abstract machine. Rather, conforming implementations are required to emulate (only) the <strong>observable behavior</strong> of the abstract machine as explained below.</p> </blockquote> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2022/10/1667136570480-480.webp 480w,/assets/img/blog/2022/10/1667136570480-800.webp 800w,/assets/img/blog/2022/10/1667136570480-1400.webp 1400w," sizes="(max-width: 600px) 100vw, (max-width: 1200px) 80vw, 66vw" type="image/webp"></source> <img src="/assets/img/blog/2022/10/1667136570480.png" width="100%" height="auto" loading="lazy"> </picture> </figure> <h3 id="well-formed-ill-formed-and-ifndr-program">Well-Formed, ill-formed, and IFNDR Program</h3> <blockquote> <p>[defns.well.formed](3.32) C++ program constructed according to the syntax rules, diagnosable semantic rules, and the one-definition rule</p> </blockquote> <blockquote> <p>for a well-formed program construct and correct data, that depends on the implementation and that each implementation documents</p> </blockquote> <blockquote> <p>for a well-formed program construct and correct data, that depends on the implementation</p> <ul> <li>Each unspecified behavior yields one result from the set of all possible valid results</li> <li>This is the nondeterminism aspect of the abstract machine</li> <li>eg <ul> <li>the evaluation order of arguments</li> <li>how to store identical string literals</li> </ul> </li> </ul> </blockquote> <blockquote> <p>ill-formed program is not well-formed. ie. has syntax errors or diagnosable semantic errors</p> </blockquote> <blockquote> <p>IFNDR (ill-formed, no diagnostic required) program is a program that has non-diagnosable semantic error</p> </blockquote> <h3 id="structure-of-c-abstract-machine">Structure of C++ Abstract Machine</h3> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/blog/2022/10/1667136579085-480.webp 480w,/assets/img/blog/2022/10/1667136579085-800.webp 800w,/assets/img/blog/2022/10/1667136579085-1400.webp 1400w," sizes="(max-width: 600px) 100vw, (max-width: 1200px) 80vw, 66vw" type="image/webp"></source> <img src="/assets/img/blog/2022/10/1667136579085.png" width="100%" height="auto" loading="lazy"> </picture> </figure> <h4 id="memory">Memory</h4> <ul> <li>Memory is a single flat space</li> <li>All parts of memory are equally reachable by the abstract machine</li> <li>There is no memory hierarchy <ul> <li>No concept of stack, registers, or cache (Although stack unwinding is mentioned several times)</li> <li>No concept of heterogeneous memory (e.g., GPUs, co-processors)</li> </ul> </li> <li>Access to memory has uniform latency</li> <li>Memory is composed of bytes <ul> <li>The standard specifies the minimum requirements for what a byte is in terms of what it must be able to represent</li> </ul> </li> <li>The memory available to a program consists of one or more sequences of contiguous bytes <ul> <li>Any operation in a program can potentially access any memory location in those sequences of bytes</li> </ul> </li> <li>Every byte has a unique location in memory - its address <ul> <li>Addresses are represented in our program by pointers</li> </ul> </li> </ul> <h4 id="objects">Objects</h4> <ul> <li>Operations in a program create, destroy, refer to, access, and manipulate objects, which have <ul> <li>size</li> <li>alignment</li> <li>storage duration</li> <li>lifetime</li> <li>type</li> <li>value</li> <li>name (optional)</li> </ul> </li> <li>An object may have at most one memory location</li> <li>An implementation is allowed to store two objects at the same address, or not store an object at all, if the program cannot observe the difference (the as-if rule at work!)</li> </ul> <h4 id="expressions">Expressions</h4> <ul> <li>Every C++ expression has an associated type</li> <li>Every C++ expression is a member of a value category</li> </ul> <h4 id="threads">Threads</h4> <ul> <li>What does it mean to invoke and execute a function? <ul> <li>Functions consist of statements</li> <li>Statements consist of expressions</li> </ul> </li> <li>An expression is a sequence of operators and operands that specifies a computation <ul> <li>To perform that computation, the expression must be evaluated</li> <li>Evaluating an expression can result in a value and can cause side effects</li> </ul> </li> <li>Evaluating an expressions that causes side effects results in changes to the program’s execution state, and possibly to observable behavior</li> <li>The C++ standard rules governing the evaluation of expression are formulated in terms of an expression’s type and value category</li> </ul> <h2 id="btb-structure-of-program">BTB: structure of program</h2> <blockquote> <p>Talk: https://www.youtube.com/watch?v=3KoXeegncrs</p> <p>Link: <a href="https://github.com/CppCon/CppCon2020/blob/main/Presentations/back_to_basics_the_structure_of_a_program/back_to_basics_the_structure_of_a_program__bob_steagall__cppcon_2020.pdf" rel="external nofollow noopener" target="_blank">back_to_basics_the_structure_of_a_program__bob_steagall__cppcon_2020.pdf</a></p> </blockquote> <h3 id="translational-units-and-phrase-of-translation">Translational Units and Phrase of Translation</h3> <ol> <li>A translation unit is defined (roughly) as <ol> <li>A source file,</li> <li>Plus with all the headers and source files included via the #include directive,</li> <li>Minus any source lines skipped by conditional inclusion preprocessing directives (#ifdef),</li> <li>And all macros expanded</li> </ol> </li> <li>9 phrases <ol> <li>Preprocessing (Phrase 1 - 6) (page.22 - 27) <ol> <li>The output is the so-called translational unit</li> </ol> </li> <li>Compilation: syntax analysis, semantic analysis, codegen (Phrase 7 - 8) <ol> <li>The output is the translated translational unit</li> </ol> </li> <li>Linking: image creation</li> </ol> </li> </ol> <h3 id="declaration-and-definition">Declaration and Definition</h3> <ol> <li>Entity (These rules are about Entity)</li> <li>Name of the entity <ol> <li>What surprises me is that: variable inside functions are declaration; this conforms to our big pictures in (3): the set of definition is a subset of declaration.</li> </ol> </li> <li>Declaration <ol> <li>Name of the entity is introduced by declaration</li> </ol> </li> <li>Definition <ol> <li>Every declaration is also a definition except …</li> </ol> </li> </ol> <h3 id="linkage">Linkage</h3> <ol> <li>If names are these types of things …, then it may have linkage</li> <li>External Linkage: can be used by other translational unit</li> <li>Internal Linkage: can be used inside the entire translational unit</li> <li>No Linkage: can only be used within the scope it’s declared</li> </ol> <h3 id="odr">ODR</h3> <ol> <li>A given translational unit can contain at most one definition of any …</li> <li>A given program must contain exactly one definition of every non-inline variable or function that is used in the program <ul> <li>multiple declarations are OK, but only one definition</li> </ul> </li> </ol> <p>For an inline variable or an inline function, a definition is required in every translation unit that uses it</p> <ul> <li>inline was originally a suggested optimization made to the compiler</li> <li>It has now evolved to mean “multiple definitions are permitted”</li> <li>So, <code class="language-plaintext highlighter-rouge">inline</code> doesn’t necessarily make compiler create inline functions, but can also issue weak symbol that lets linker to choose one definition when linking</li> </ul> <h3 id="abi">ABI</h3> <p>ABI (application binary interface) is the platform-specific specification of how entities defined in one TU interact with entities defined in another TU</p> <ul> <li>Compilers and Linkers must agree on the same ABI</li> </ul> <p>For C++, this includes things like</p> <ul> <li>Name mangling for functions</li> <li>Name mangling for non-template types</li> <li>Name mangling for template instantiations</li> <li>The size, layout, and alignment of objects of any given type</li> <li>How the bytes in an object’s binary representation are interpreted</li> <li>Calling conventions for passing arguments to functions and receiving a returned object</li> <li>Calling conventions for making system calls</li> </ul> <p>On Linux, GCC and Clang use the Itanium ABI; On Windows, MSVC uses its own ABI</p> <h3 id="name-mangling">Name Mangling</h3> <p>The C language does not provide overloading or namespaces</p> <ul> <li>Given a C function whose declaration is void fubar (int),</li> <li>The corresponding symbol name in object code is fubar</li> <li>The symbol name will be the same no matter the number of parameters or their types</li> </ul> </div> </article> </div> </main> <footer class="sticky-bottom" role="contentinfo"> <div class="post-version"> © 2025 <a href="/">Yuxiang Qiu</a> <br> v25-02-18 | <a href="https://github.com/yuxqiu/yuxqiu.github.io/commit/164661fe14bea1e047a15eeaa5ed3429c0d08a3e" rel="external nofollow noopener" target="_blank">164661f</a> </div> </footer> </body> </html>